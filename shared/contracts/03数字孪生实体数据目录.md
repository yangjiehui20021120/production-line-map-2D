# 数字孪生实体数据目录

**Digital Twin Entity Data Catalog**

版本: v1.0  
日期: 2025-11-10  
适用产品: M670, M803 侧墙生产线

---

## 文档说明

本数据目录详细列出了侧墙生产线数字孪生系统中所有可查询的实体类型、字段定义、关系结构和数据模态。该目录为业务优化智能应用的设计和开发提供完整的数据清单。

**使用方式**:
1. 先查阅本数据目录,了解"有哪些数据可用"
2. 再参考《数字孪生平台数据服务接口技术规范》,了解"如何获取这些数据"

---

## 目录

1. [四层架构数据分布](#1-四层架构数据分布)
2. [实体类型总览](#2-实体类型总览)
3. [TwinObject 实体族](#3-twinobject-实体族)
   - 3.1 核心字段
   - 3.2 OrgUnit (组织单元)
   - 3.3 Station (工位)
   - 3.4 Position (台位)
   - 3.5 AutoEquipment (自动化设备)
   - 3.6 TransportEquip (运输设备)
   - 3.7 Person (人员)
   - 3.8 Role (角色)
   - 3.9 Material (物料)
   - 3.10 Product (产品)
   - 3.11 Workpiece (工件)
   - 3.12 QCTool (检具)
4. [MBOM 工艺实体族](#4-mbom-工艺实体族)
   - 4.1 MBOM_Root (工艺根)
   - 4.2 MBOM_Route (路线)
   - 4.3 MBOM_Takt (节拍)
   - 4.4 MBOM_Process (工序)
   - 4.5 MBOM_Step (工步)
5. [Scene 场景实体](#5-scene-场景实体)
6. [模态数据系统](#6-模态数据系统)
   - 6.1 Modality (数据模态定义)
   - 6.2 ModalityBinding (模态绑定)
   - 6.3 ModalData (运行数据)
7. [Assignment 岗位指派实体](#7-assignment-岗位指派实体)
8. [实体关系图谱](#8-实体关系图谱)
9. [数据模态清单](#9-数据模态清单)
10. [业务场景数据映射](#10-业务场景数据映射)

---

## 1. 四层架构数据分布

| 架构层级 | 实体类型 | 数据量 | 变更频率 | 典型用途 |
|---------|---------|--------|---------|---------|
| **运行数据层**<br>Runtime Data | ModalData | 1,971条+ | 高频(秒级) | 设备参数、质量数据、过程监控 |
| **执行场景层**<br>Execution Scenario | Scene<br>ModalityBinding | 10条场景<br>352条绑定 | 中频(按批次) | 工件生产过程、数据绑定配置 |
| **工艺定义层**<br>Process Definition | MBOM_Root<br>MBOM_Route<br>MBOM_Takt<br>MBOM_Process<br>MBOM_Step | 234个工艺实体 | 低频(月度) | 工艺流程、工序定义、标准工时 |
| **资源配置层**<br>Resource Config | TwinObject (11种子类型)<br>Role<br>Assignment | 资源配置实体 | 低频(季度) | 组织结构、设备配置、人员岗位 |

---

## 2. 实体类型总览

### 2.1 实体类型清单

| 序号 | 实体类型 | 所属层级 | 中文名称 | 实例数量 | 核心关系 |
|-----|---------|---------|---------|---------|---------|
| 1 | **TwinObject** (基类) | Resource | 孪生对象 | - | - |
| 1.1 | OrgUnit | Resource | 组织单元 | 4 | parentOrg |
| 1.2 | Station | Resource | 工位 | 28 | stationLocation, hasPositions |
| 1.3 | Position | Resource | 台位 | - | belongsToStation |
| 1.4 | AutoEquipment | Resource | 自动化设备 | 33 | deployedAt |
| 1.5 | TransportEquip | Resource | 运输设备 | - | - |
| 1.6 | Person | Resource | 人员 | - | holdsPosition, assignedRole |
| 1.7 | Material | Resource | 物料 | - | - |
| 1.8 | Product | Resource | 产品 | 2 | - |
| 1.9 | Workpiece | Resource | 工件 | 10 | productType |
| 1.10 | QCTool | Resource | 检具 | - | - |
| 2 | **Role** | Resource | 角色定义 | 18 | - |
| 3 | **Assignment** | Resource | 岗位指派 | - | assigneeId, roleId, orgId |
| 4 | **MBOM_Root** | Process | MBOM根 | 2 | rootProcess, hasRoute |
| 5 | **MBOM_Route** | Process | 路线 | 2 | partOfMBOM, consistsOfTakts |
| 6 | **MBOM_Takt** | Process | 节拍 | 15 | partOfRoute, includesProcesses |
| 7 | **MBOM_Process** | Process | 工序 | 141 | partOfTakt, composedOfSteps, nextProcess |
| 8 | **MBOM_Step** | Process | 工步 | 74 | partOfProcess, nextStep |
| 9 | **Scene** | Execution | 生产场景 | 10 | workpieceId, taktRef |
| 10 | **Modality** | Execution | 数据模态 | 40 | - |
| 11 | **ModalityBinding** | Execution | 模态绑定 | 352 | twinId, modalityId |
| 12 | **ModalData** | Runtime | 运行数据 | 1,971+ | refTwin, refScene, refModality |

### 2.2 URN 命名规范

所有实体使用URN作为全局唯一标识符:

```
urn:ngsi-ld:{EntityType}:{Identifier}
```

**示例**:
- `urn:ngsi-ld:TwinObject:OrgUnit:SideWallLine`
- `urn:ngsi-ld:TwinObject:AutoEquipment:361-01173`
- `urn:ngsi-ld:MBOM:M000004670327:T01:P0010`
- `urn:ngsi-ld:Scene:FrontWelding_20250808_093512`
- `urn:ngsi-ld:Modality:WeldingCurrent_Auto`

---

## 3. TwinObject 实体族

TwinObject是资源层的统一基类,通过`subType`属性区分11种具体子类型。

### 3.1 TwinObject 核心字段

所有TwinObject子类型共享以下核心字段:

| 字段名 | 类型 | 必填 | 说明 | 典型值 |
|-------|------|-----|------|--------|
| **id** | URN | ✓ | 全局唯一标识符 | `urn:ngsi-ld:TwinObject:AutoEquipment:361-01173` |
| **type** | String | ✓ | 固定为"TwinObject" | `TwinObject` |
| **subType** | Property | ✓ | 子类型标识 | `AutoEquipment`, `Station`, `Person`等 |
| **name** | Property | ✓ | 对象名称 | "前围焊接机器人" |
| **twinType** | Property | ✓ | 顶层分类 | `Constituent`(构成性), `Transitional`(流转性) |
| **functionCategory** | Property | ✓ | 生产功能分类 | `F1.AutoWelding`, `F2.Workpiece` |
| **location** | GeoProperty | - | 地理位置坐标 | `{"type": "Point", "coordinates": [x, y, z]}` |
| **capabilities** | Property | - | 能力标签集合 | `["MIG焊接", "机械手搬运"]` |
| **specifications** | Property | - | 技术规格参数 | `{"maxLoad": 500, "reach": 2800}` |

### 3.2 OrgUnit (组织单元)

**实体标识**: `subType.value = "OrgUnit"`  
**实例数量**: 4个  
**典型URN**: `urn:ngsi-ld:TwinObject:OrgUnit:SideWallLine`

#### 特有字段

| 字段名 | 类型 | 必填 | 说明 | 枚举值/示例 |
|-------|------|-----|------|-----------|
| **orgUnitType** | Property | ✓ | 组织类型 | `Factory`, `Workshop`, `ProductionLine`, `Team`, `Department`, `Division` |
| **orgLevel** | Property | ✓ | 组织层级 | 1(工厂), 2(车间), 3(产线), 4(班组) |
| **orgStatus** | Property | - | 组织状态 | `Active`, `Inactive`, `Restructuring` |
| **parentOrg** | Relationship | - | 上级组织 | `urn:ngsi-ld:TwinObject:OrgUnit:BodyWorkshop` |
| **childOrgs** | Relationship[] | - | 下级组织列表 | `[urn:ngsi-ld:TwinObject:OrgUnit:SideWallLine-TeamA]` |

#### 典型实例

```
侧墙产线 (SideWallLine)
  ├─ 类型: ProductionLine
  ├─ 层级: 3
  ├─ 上级: 车身车间 (BodyWorkshop)
  └─ 下级: 侧墙产线A班 (SideWallLine-TeamA)
```

---

### 3.3 Station (工位)

**实体标识**: `subType.value = "Station"`  
**实例数量**: 28个  
**典型URN**: `urn:ngsi-ld:TwinObject:Station:FrontWelding`

#### 特有字段

| 字段名 | 类型 | 必填 | 说明 | 枚举值/示例 |
|-------|------|-----|------|-----------|
| **stationCategory** | Property | ✓ | 工位类别 | `ProductionStation`, `InspectionStation`, `AssemblyStation`, `BufferZone`, `HandlingStation` |
| **areaCode** | Property | - | 所属区域代码 | `"AREA-01"` |
| **zoneId** | Property | - | 所属分区标识 | `"ZONE-A"` |
| **capacityWip** | Property | - | 在制品容量(件) | 5 |
| **stationLocation** | Relationship | - | 所属组织单元 | `urn:ngsi-ld:TwinObject:OrgUnit:SideWallLine` |
| **hasPositions** | Relationship[] | - | 包含的台位列表 | `[urn:ngsi-ld:TwinObject:Position:ST-HJ-P01]` |
| **deployedEquipments** | Relationship[] | - | 部署的设备列表 | `[urn:ngsi-ld:TwinObject:AutoEquipment:361-01173]` |

#### 典型实例

```
前围焊接工位 (FrontWelding)
  ├─ 类别: ProductionStation
  ├─ 容量: 2件在制品
  ├─ 设备: 361-01173(焊接机器人), 361-900A(变位机)
  └─ 所属: 侧墙产线
```

---

### 3.4 Position (台位)

**实体标识**: `subType.value = "Position"`  
**典型URN**: `urn:ngsi-ld:TwinObject:Position:ST-HJ-P01`

#### 特有字段

| 字段名 | 类型 | 必填 | 说明 | 枚举值/示例 |
|-------|------|-----|------|-----------|
| **belongsToStation** | Relationship | ✓ | 所属工位 | `urn:ngsi-ld:TwinObject:Station:FrontWelding` |
| **positionIndex** | Property | - | 台位编号 | `"P01"`, `"A1"` |
| **positionType** | Property | - | 台位类型 | `WorkTable`, `LoadingPoint`, `UnloadingPoint`, `InspectionPoint`, `FixturePoint`, `BufferPoint`, `HandoverPoint` |
| **relativeOffset** | Property | - | 相对工位坐标偏移 | `{"x": 1200, "y": 500, "z": 0}` (mm) |

---

### 3.5 AutoEquipment (自动化设备)

**实体标识**: `subType.value = "AutoEquipment"`  
**实例数量**: 33个  
**典型URN**: `urn:ngsi-ld:TwinObject:AutoEquipment:361-01173`

#### 特有字段

| 字段名 | 类型 | 必填 | 说明 | 枚举值/示例 |
|-------|------|-----|------|-----------|
| **equipmentType** | Property | ✓ | 设备细分类型 | `WeldingRobot`, `Welder`, `Positioner`, `CNC`, `PressMachine`, `Laser` |
| **controllerType** | Property | - | 控制器类型 | `"ABB_IRC5"`, `"FANUC_R-30iB"`, `"KUKA_KRC4"`, `"Siemens_840D"` |
| **controllerVersion** | Property | - | 控制器软件版本 | `"7.5.1"` |
| **axes** | Property | - | 轴数 | 6 (机器人/CNC) |
| **maxPayload** | Property | - | 最大负载(kg) | 500 |
| **reach** | Property | - | 工作半径(mm) | 2800 |
| **manufacturer** | Property | - | 制造商 | `"ABB"`, `"KUKA"`, `"Fronius"` |
| **model** | Property | - | 型号 | `"IRB 6700-200/2.80"` |
| **serialNumber** | Property | - | 序列号 | `"SN-2023-001173"` |
| **commissionDate** | Property | - | 投产日期 | `"2024-03-15"` |
| **deployedAt** | Relationship | - | 部署位置(工位) | `urn:ngsi-ld:TwinObject:Station:FrontWelding` |
| **supportedProcesses** | Property[] | - | 支持的工艺类型 | `["MIG焊接", "点焊"]` |

#### 典型实例

```
前围焊接机器人 (361-01173)
  ├─ 类型: WeldingRobot
  ├─ 制造商: ABB
  ├─ 型号: IRB 6700-200/2.80
  ├─ 控制器: ABB_IRC5 v7.5.1
  ├─ 轴数: 6轴
  ├─ 负载: 200kg
  ├─ 半径: 2800mm
  ├─ 部署: 前围焊接工位
  └─ 绑定数据: 焊接电流、保护气流量、TCP位姿等
```

---

### 3.6 TransportEquip (运输设备)

**实体标识**: `subType.value = "TransportEquipment"`  
**典型URN**: `urn:ngsi-ld:TwinObject:TransportEquip:Crane-01`

#### 特有字段

| 字段名 | 类型 | 必填 | 说明 | 枚举值/示例 |
|-------|------|-----|------|-----------|
| **transportType** | Property | ✓ | 运输设备类型 | `Crane`, `AGV`, `RGV`, `Conveyor`, `Hoist`, `Forklift`, `Shuttle` |
| **liftingCapacity** | Property | - | 额定起重量(kg/ton) | 5000 |
| **spanLength** | Property | - | 跨度(m) - 天车 | 15.5 |
| **liftingHeight** | Property | - | 起升高度(m) | 8.0 |
| **travelSpeed** | Property | - | 行走速度(m/min) | 45 |
| **servicedZones** | Property[] | - | 服务区域列表 | `["ZONE-A", "ZONE-B"]` |

---

### 3.7 Person (人员)

**实体标识**: `subType.value = "Person"`  
**典型URN**: `urn:ngsi-ld:TwinObject:Person:EMP001`

#### 特有字段

| 字段名 | 类型 | 必填 | 说明 | 枚举值/示例 |
|-------|------|-----|------|-----------|
| **employeeId** | Property | ✓ | 员工编号 | `"EMP-20250101"` |
| **department** | Property | - | 所属部门 | `"车身车间"` |
| **workgroup** | Property | - | 班组 | `"侧墙产线A班"` |
| **skills** | Property[] | - | 技能标签 | `["Skill.Welding.MIG", "Skill.Robot.Programming"]` |
| **certifications** | Property[] | - | 资格证书 | `["焊工证-高级", "特种设备操作证"]` |
| **shiftSchedule** | Property | - | 排班模式 | `"TwoShift"`, `"ThreeShift"`, `"Fixed"` |
| **holdsPosition** | Relationship | - | 任职岗位 | `urn:ngsi-ld:TwinObject:Position:ST-HJ-P01` |
| **assignedRole** | Relationship[] | - | 分配角色 | `[urn:ngsi-ld:Role:Welder, urn:ngsi-ld:Role:TeamLeader]` |

---

### 3.8 Role (角色)

**实体类型**: `Role` (独立实体,非TwinObject子类)  
**实例数量**: 18个  
**典型URN**: `urn:ngsi-ld:Role:Welder`

#### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | 角色唯一标识 | `urn:ngsi-ld:Role:Welder` |
| **type** | String | ✓ | 固定为"Role" | `Role` |
| **name** | Property | ✓ | 角色名称 | `"焊工"`, `"班组长"`, `"质检员"` |
| **description** | Property | - | 角色描述 | `"负责侧墙焊接作业的一线操作人员"` |
| **responsibilities** | Property[] | ✓ | 主要职责列表 | `["执行焊接作业", "自检焊缝质量", "填写作业记录"]` |
| **permissionSet** | Property[] | - | 系统权限集合 | `["MES_ConfirmProcess", "MES_ReportQuality"]` |
| **qualificationReq** | Relationship[] | - | 任职资质要求 | `[urn:ngsi-ld:Qualification:WelderCert]` |
| **kpiOwnership** | Property[] | - | 负责的KPI指标 | `["WeldingQualityRate", "ProductionEfficiency"]` |
| **orgScope** | Relationship | - | 适用组织范围 | `urn:ngsi-ld:TwinObject:OrgUnit:SideWallLine` |
| **effectiveFrom** | Property | - | 生效时间 | `"2025-01-01T00:00:00Z"` |

#### 典型实例

```
焊工 (Welder)
  ├─ 职责:
  │   ├─ 执行MIG/MAG焊接作业
  │   ├─ 自检焊缝外观质量
  │   └─ 填写焊接参数记录单
  ├─ 权限: MES_ConfirmProcess, MES_ReportQuality
  ├─ 资质要求: 焊工证(中级及以上)
  └─ KPI: 焊接合格率、作业效率
```

**当前角色清单** (18个):
- Welder (焊工)
- TeamLeader (班组长)
- QualityInspector (质检员)
- MaintenanceTech (维修技术员)
- Electrician (电工)
- Assembler (装配工)
- Operator (操作工)
- WaterSpider (物料配送员)
- CraneOperator (天车工)
- 等...

---

### 3.9 Material (物料)

**实体标识**: `subType.value = "Material"`  
**典型URN**: `urn:ngsi-ld:TwinObject:Material:MAT-001`

#### 特有字段

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| **materialCode** | Property | 物料编码 | `"MAT-STEEL-Q345-3MM"` |
| **materialType** | Property | 物料类型 | `RawMaterial`, `Component`, `Consumable` |
| **specification** | Property | 规格型号 | `"Q345钢板 3mm×1500mm×6000mm"` |
| **unitOfMeasure** | Property | 计量单位 | `"kg"`, `"pcs"`, `"m"` |
| **supplierCode** | Property | 供应商代码 | `"SUPP-001"` |

---

### 3.10 Product (产品)

**实体标识**: `subType.value = "Product"`  
**实例数量**: 2个  
**典型URN**: `urn:ngsi-ld:TwinObject:Product:M000004670327`

#### 特有字段

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| **productCode** | Property | 产品编号 | `"M000004670327"`, `"M000004803474"` |
| **productName** | Property | 产品名称 | `"M670型侧墙"`, `"M803型一位侧墙"` |
| **productFamily** | Property | 产品族 | `"侧墙总成"` |
| **version** | Property | 版本号 | `"V3.2"` |
| **mbomRef** | Relationship | 关联MBOM | `urn:ngsi-ld:MBOM:M000004670327` |

#### 当前产品实例

| 产品编号 | 产品名称 | MBOM节拍数 | 工序数 | 工步数 |
|---------|---------|-----------|-------|-------|
| M000004670327 | M670型侧墙 | 8个 | 69个 | 36个 |
| M000004803474 | M803型一位侧墙 | 7个 | 72个 | 38个 |

---

### 3.11 Workpiece (工件)

**实体标识**: `subType.value = "Workpiece"`  
**实例数量**: 10个 (M670×5 + M803×5)  
**典型URN**: `urn:ngsi-ld:Workpiece:M670-SN001`

#### 特有字段

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| **workpieceCode** | Property | 工件批次号/序列号 | `"M670-SN001"`, `"M803-SN002"` |
| **productType** | Relationship | 所属产品类型 | `urn:ngsi-ld:TwinObject:Product:M000004670327` |
| **productionOrder** | Property | 生产订单号 | `"PO-2025-08-001"` |
| **batchNumber** | Property | 批次号 | `"BATCH-202508-001"` |
| **currentStatus** | Property | 当前状态 | `InProduction`, `QualityCheck`, `Completed`, `Scrapped` |
| **currentLocation** | Relationship | 当前位置 | `urn:ngsi-ld:TwinObject:Station:FrontWelding` |
| **startTime** | Property | 生产开始时间 | `"2025-08-08T08:00:00Z"` |

#### 当前工件实例

| 工件编号 | 产品类型 | 场景数 | 状态 |
|---------|---------|-------|------|
| M670-SN001 ~ SN005 | M670型侧墙 | 5个场景/件 | 生产中 |
| M803-SN001 ~ SN005 | M803型一位侧墙 | 5个场景/件 | 生产中 |

---

### 3.12 QCTool (检具)

**实体标识**: `subType.value = "QCTool"`  
**典型URN**: `urn:ngsi-ld:TwinObject:QCTool:JG-FW-001`

#### 特有字段

| 字段名 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| **toolType** | Property | 检具类型 | `MeasuringTool`, `InspectionFixture`, `Gauge`, `Scanner` |
| **measurementRange** | Property | 测量范围 | `"0-500mm ±0.01mm"` |
| **calibrationDate** | Property | 校准日期 | `"2025-06-01"` |
| **calibrationDueDate** | Property | 下次校准日期 | `"2026-06-01"` |
| **accuracy** | Property | 精度 | `"±0.01mm"` |

---

## 4. MBOM 工艺实体族

MBOM(制造物料清单)实体族定义了完整的产品制造工艺流程,采用四层结构。

### 4.1 MBOM_Root (MBOM根)

**实体类型**: `MBOM` (通过`mbomType = "MBOMRoot"`区分)  
**实例数量**: 2个 (M670, M803各1个)  
**典型URN**: `urn:ngsi-ld:MBOM:M000004670327`

#### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | MBOM根唯一标识 | `urn:ngsi-ld:MBOM:M000004670327` |
| **type** | String | ✓ | 固定为"MBOM" | `MBOM` |
| **mbomType** | Property | ✓ | 固定为"MBOMRoot" | `MBOMRoot` |
| **productCode** | Property | ✓ | 关联产品代码 | `"M000004670327"` |
| **mbomVersion** | Property | ✓ | MBOM版本号 | `"V1.0"` |
| **status** | Property | ✓ | MBOM状态 | `draft`, `active`, `retired`, `deprecated` |
| **effectiveFrom** | Property | - | 生效开始时间 | `"2025-01-01T00:00:00Z"` |
| **effectiveTo** | Property | - | 生效结束时间 | `"2030-12-31T23:59:59Z"` |
| **hasRoute** | Relationship | ✓ | 指向唯一路线 | `urn:ngsi-ld:MBOM:RT_M000004670327:V1.0` |
| **totalEstimatedTime** | Property | - | 总预估工时(分钟) | 4620 |

---

### 4.2 MBOM_Route (路线)

**实体类型**: `MBOM` (通过`mbomType = "Route"`区分)  
**实例数量**: 2个  
**典型URN**: `urn:ngsi-ld:MBOM:RT_M000004670327:V1.0`

#### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | 路线唯一标识 | `urn:ngsi-ld:MBOM:RT_M000004670327:V1.0` |
| **mbomType** | Property | ✓ | 固定为"Route" | `Route` |
| **routeName** | Property | ✓ | 路线名称 | `"M670侧墙标准生产路线"` |
| **routeCode** | Property | - | 路线代码 | `"RT_M000004670327"` |
| **partOfMBOM** | Relationship | ✓ | 所属MBOM根 | `urn:ngsi-ld:MBOM:M000004670327` |
| **consistsOfTakts** | Relationship[] | ✓ | 包含的节拍列表 | `[urn:ngsi-ld:MBOM:M000004670327:T01, ...]` |
| **taktCount** | Property | - | 节拍总数 | 8 |
| **totalCycleTime** | Property | - | 总周期时间(分钟) | 4620 |

---

### 4.3 MBOM_Takt (节拍)

**实体类型**: `MBOM` (通过`mbomType = "Takt"`区分)  
**实例数量**: 15个 (M670×8 + M803×7)  
**典型URN**: `urn:ngsi-ld:MBOM:M000004670327:T01`

#### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | 节拍唯一标识 | `urn:ngsi-ld:MBOM:M000004670327:T01` |
| **mbomType** | Property | ✓ | 固定为"Takt" | `Takt` |
| **taktSeq** | Property | ✓ | 节拍序号 | 1, 2, 3... |
| **taktName** | Property | ✓ | 节拍名称 | `"M000004670327侧墙组成节拍1"` |
| **targetCT** | Property | - | 目标节拍时间(分钟) | 420 |
| **partOfRoute** | Relationship | ✓ | 所属路线 | `urn:ngsi-ld:MBOM:RT_M000004670327:V1.0` |
| **includesProcesses** | Relationship[] | ✓ | 包含的工序列表 | `[urn:ngsi-ld:MBOM:M000004670327:T01:P0010, ...]` |
| **processCount** | Property | - | 工序总数 | 12 |
| **estimatedDuration** | Property | - | 预估总时长(分钟) | 425 |

---

### 4.4 MBOM_Process (工序)

**实体类型**: `MBOM` (通过`mbomType = "Process"`区分)  
**实例数量**: 141个 (M670×69 + M803×72)  
**典型URN**: `urn:ngsi-ld:MBOM:M000004670327:T01:P0010`

#### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | 工序唯一标识 | `urn:ngsi-ld:MBOM:M000004670327:T01:P0010` |
| **mbomType** | Property | ✓ | 固定为"Process" | `Process` |
| **procCode** | Property | - | 工序代码 | `"0010"`, `"0020"` |
| **procName** | Property | ✓ | 工序名称 | `"焊接侧墙前面焊缝"` |
| **procSeqInTakt** | Property | ✓ | 工序在节拍内序号 | 1, 2, 3... |
| **procKind** | Property | - | 工序类型 | `process`(加工), `handling`(搬运), `inspection`(检验), `andon`(报警), `measurement`(测量) |
| **partOfTakt** | Relationship | ✓ | 所属节拍 | `urn:ngsi-ld:MBOM:M000004670327:T01` |
| **nextProcess** | Relationship | - | 后续工序 | `urn:ngsi-ld:MBOM:M000004670327:T01:P0020` |
| **composedOfSteps** | Relationship[] | ✓ | 包含的工步列表 | `[urn:ngsi-ld:MBOM:M000004670327:T01:P0010:S01, ...]` |
| **stepCount** | Property | - | 工步总数 | 3 |
| **estimatedDuration** | Property | - | 预估工序时长(分钟) | 210 |

---

### 4.5 MBOM_Step (工步)

**实体类型**: `MBOM` (通过`mbomType = "Step"`区分)  
**实例数量**: 74个 (M670×36 + M803×38)  
**典型URN**: `urn:ngsi-ld:MBOM:M000004670327:T01:P0010:S01`

#### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | 工步唯一标识 | `urn:ngsi-ld:MBOM:M000004670327:T01:P0010:S01` |
| **mbomType** | Property | ✓ | 固定为"Step" | `Step` |
| **stepSeq** | Property | ✓ | 工步序号 | 1, 2, 3... |
| **stepCode** | Property | - | 工步代码 | `"S01"` |
| **stepName** | Property | ✓ | 工步名称 | `"焊接前围焊缝"` |
| **stdTime** | Property | ✓ | 标准工时(分钟) | 210 |
| **processKind** | Property | - | 工步类型(继承自Process) | `process`, `handling`, `inspection` |
| **stationCode** | Property | ✓ | 执行工位代码 | `"ST-HJ-01"`, `"ST-UNKNOWN"` |
| **positionCode** | Property | - | 工位内位置代码 | `"P01"` |
| **partOfProcess** | Relationship | ✓ | 所属工序 | `urn:ngsi-ld:MBOM:M000004670327:T01:P0010` |
| **nextStep** | Relationship | - | 后续工步 | `urn:ngsi-ld:MBOM:M000004670327:T01:P0010:S02` |
| **resourceClasses** | Property[] | - | 所需资源类别 | `["AUTO_WELDER", "ROBOT", "QC_TOOL"]` |
| **requiredMeasurements** | Property[] | - | 测量要求定义 | 详见下表 |

#### 测量要求结构 (requiredMeasurements)

| 子字段 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| **modalityCode** | String | 数据模态代码 | `"WeldingCurrent"`, `"WeldSeamWidth"` |
| **ruleId** | String | 质量规则ID | `"RULE_CURRENT_150_250A"` |
| **timing** | String | 测量时机 | `in`(过程中), `post`(完成后), `pre`(开始前) |
| **aggregator** | String | 聚合方式 | `mean`, `min`, `max`, `stddev` |
| **sampleSize** | Integer | 采样数量 | 5 |
| **capturedByResourceClass** | String | 采集资源类别 | `"AUTO_WELDER"`, `"QC_TOOL"` |

---

## 5. Scene 场景实体

Scene实体代表一个工件在某个节拍下的实际执行过程实例。

**实体类型**: `Scene`  
**实例数量**: 10个 (每个工件1个场景)  
**典型URN**: `urn:ngsi-ld:Scene:FrontWelding_20250808_093512`

### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | 场景唯一标识 | `urn:ngsi-ld:Scene:FrontWelding_20250808_093512` |
| **type** | String | ✓ | 固定为"Scene" | `Scene` |
| **sceneName** | Property | - | 场景名称 | `"前围焊接场景-20250808"` |
| **workpieceId** | Relationship | ✓ | 关联工件 | `urn:ngsi-ld:Workpiece:M670-SN001` |
| **taktRef** | Relationship | ✓ | 关联节拍 | `urn:ngsi-ld:MBOM:M000004670327:T01` |
| **sceneStartTime** | Property | ✓ | 场景开始时间 | `"2025-08-08T09:35:12Z"` |
| **sceneEndTime** | Property | - | 场景结束时间 | `"2025-08-08T09:42:18Z"` |
| **sceneStatus** | Property | - | 场景状态 | `InProgress`, `Completed`, `Paused`, `Aborted` |
| **stepLog** | Property | - | 工步执行日志 | 详见下表 |

### stepLog 结构

stepLog记录了场景中每个工步的实际执行情况:

| 子字段 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| **stepId** | URN | 工步ID | `urn:ngsi-ld:MBOM:M000004670327:T01:P0010:S01` |
| **stepName** | String | 工步名称 | `"前围焊接"` |
| **actualDuration** | Integer | 实际用时(秒) | 426 |
| **startTime** | DateTime | 开始时间 | `"2025-08-08T09:35:12Z"` |
| **endTime** | DateTime | 结束时间 | `"2025-08-08T09:42:18Z"` |
| **operators** | Object[] | 操作人员列表 | `[{"personId": "urn:...:Person:EMP001", "roleId": "urn:...:Role:Welder"}]` |
| **usedEquipment** | URN[] | 使用的设备 | `["urn:...:AutoEquipment:361-01173"]` |
| **qualityStatus** | String | 质量状态 | `OK`, `NG`, `Rework` |

### 典型实例

```json
{
  "id": "urn:ngsi-ld:Scene:FrontWelding_20250808_093512",
  "type": "Scene",
  "workpieceId": {"type": "Relationship", "object": "urn:ngsi-ld:Workpiece:M670-SN001"},
  "taktRef": {"type": "Relationship", "object": "urn:ngsi-ld:MBOM:M000004670327:T01"},
  "sceneStartTime": {"type": "Property", "value": "2025-08-08T09:35:12Z"},
  "sceneEndTime": {"type": "Property", "value": "2025-08-08T09:42:18Z"},
  "stepLog": {
    "type": "Property",
    "value": [
      {
        "stepId": "urn:ngsi-ld:MBOM:M000004670327:T01:P0010:S01",
        "stepName": "前围焊接",
        "actualDuration": 426,
        "startTime": "2025-08-08T09:35:12Z",
        "endTime": "2025-08-08T09:42:18Z",
        "operators": [
          {
            "personId": "urn:ngsi-ld:TwinObject:Person:EMP001",
            "roleId": "urn:ngsi-ld:Role:Welder"
          }
        ]
      }
    ]
  }
}
```

---

## 6. 模态数据系统

模态数据系统实现"三锚点定位"机制: **TwinObject × Scene × Modality**

### 6.1 Modality (数据模态定义)

Modality实体定义一种可观测数据的业务类型及其采集规范。

**实体类型**: `Modality`  
**实例数量**: 40种  
**典型URN**: `urn:ngsi-ld:Modality:WeldingCurrent_Auto`

#### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 枚举值/示例 |
|-------|------|-----|------|-----------|
| **id** | URN | ✓ | 模态唯一标识 | `urn:ngsi-ld:Modality:WeldingCurrent_Auto` |
| **type** | String | ✓ | 固定为"Modality" | `Modality` |
| **name** | Property | ✓ | 模态名称 | `"焊接电流(自动采集)"` |
| **description** | Property | - | 详细描述 | `"焊接过程电流，从焊机控制系统自动采集的实时曲线"` |
| **category** | Property | ✓ | 数据类别 | `ProcessParameter`, `QualityCharacteristic`, `Geometry`, `Environment`, `Energy`, `State`, `Event` |
| **valueType** | Property | ✓ | 数据值类型 | `Number`, `Integer`, `Boolean`, `Text`, `Object`, `Array`, `Timestamp` |
| **unit** | Property | - | 计量单位 | `"A"`, `"V"`, `"mm"`, `"°C"`, `"rpm"` |
| **source** | Property | ✓ | 数据来源方式 | `Sensor`, `Manual`, `Calculated`, `Simulated`, `Inferred` |
| **domain** | Property | - | 应用领域 | `process`, `quality`, `geometry`, `environment`, `energy`, `safety` |
| **allowedRange** | Property | - | 值域范围 [min, max] | `[0, 500]` (安培) |
| **accuracy** | Property | - | 测量精度 | `"±0.5%"`, `"±1A"` |
| **sampleModel** | Property | - | 采样模式 | `continuous`, `perStep`, `perPiece`, `onEvent`, `byStep` |
| **valueFormat** | Property | - | 数据格式 | `scalar`, `timeseries`, `profile`, `image`, `pointcloud`, `matrix` |
| **isDerived** | Property | - | 是否衍生数据 | `true`, `false` |
| **derivedFrom** | Relationship[] | - | 衍生来源模态 | `[urn:ngsi-ld:Modality:WeldingCurrent_Auto]` |
| **derivationRule** | Property | - | 衍生规则 | `"min over scene duration"`, `"I = P / (U * cosφ)"` |

#### 模态命名规范

建议格式: `{物理量}_{采集方式}`

示例:
- `WeldingCurrent_Auto` - 焊接电流(自动采集)
- `WeldingCurrent_Stat` - 焊接电流(统计值)
- `DriveTemp` - 驱动器温度
- `RobotTCPPose` - 机器人工具中心点位姿

---

### 6.2 ModalityBinding (模态绑定)

ModalityBinding将Modality数据字典绑定到具体TwinObject上,定义该对象上该数据点的具体采集配置。

**实体类型**: `ModalityBinding`  
**实例数量**: 352条  
**典型URN**: `urn:ngsi-ld:ModalityBinding:361-01173:WeldingCurrent_Auto:v1`

#### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | 绑定唯一标识 | `urn:ngsi-ld:ModalityBinding:361-01173:WeldingCurrent_Auto:v1` |
| **type** | String | ✓ | 固定为"ModalityBinding" | `ModalityBinding` |
| **twinId** | Relationship | ✓ | 关联的TwinObject | `urn:ngsi-ld:TwinObject:AutoEquipment:361-01173` |
| **modalityId** | Relationship | ✓ | 关联的Modality | `urn:ngsi-ld:Modality:WeldingCurrent_Auto` |
| **pointRef** | Property | ✓ | 数据采集点引用 | `"ns=2;s=361-01173.WeldingCurrent_Auto"` (OPC UA节点) |
| **sampleRate** | Property | - | 采样频率 | `"100ms"`, `"1s"`, `"byStep"`, `"onEvent"` |
| **unit** | Property | - | 单位覆盖 | `"A"`, `"mA"` |
| **axis** | Property | - | 轴号(多轴设备) | `"X"`, `"Y"`, `"Z"`, `"Main"` |
| **discriminator** | Property | - | 区分标识 | `"Left"`, `"Right"`, `"Top"` |
| **bindingVersion** | Property | ✓ | 绑定版本 | `"1.0.0"` |
| **changeId** | Property | - | 变更单号 | `"CHG-INITIAL-SETUP-2025"` |
| **effectiveFrom** | Property | ✓ | 生效时间 | `"2025-01-01T00:00:00Z"` |

#### 绑定命名规范

建议格式: `urn:ngsi-ld:ModalityBinding:{TwinName}:{ModalityName}:{Discriminator}:v{Version}`

示例:
- `urn:ngsi-ld:ModalityBinding:361-01173:WeldingCurrent_Auto:v1`
- `urn:ngsi-ld:ModalityBinding:CNCMachine01:DriveTemp:X_Main:v1`

---

### 6.3 ModalData (运行数据)

ModalData代表一条具体的数据记录或测量值,承载数字孪生系统的运行时数据。

**实体类型**: `ModalData`  
**实例数量**: 1,971+ 条  
**典型URN**: `urn:ngsi-ld:ModalData:WeldingCurrent.FrontWelding_20250808.0001`

#### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | 数据记录唯一标识 | `urn:ngsi-ld:ModalData:WeldingCurrent.FrontWelding_20250808.0001` |
| **type** | String | ✓ | 固定为"ModalData" | `ModalData` |
| **refTwin** | Relationship | ✓ | 数据产生的孪生体 (锚点1) | `urn:ngsi-ld:TwinObject:AutoEquipment:361-01173` |
| **refScene** | Relationship | ✓ | 数据产生的场景 (锚点2) | `urn:ngsi-ld:Scene:FrontWelding_20250808_093512` |
| **refModality** | Relationship | ✓ | 数据的模态类型 (锚点3) | `urn:ngsi-ld:Modality:WeldingCurrent_Auto` |
| **value** | Property | ✓ | 数据值 | `185.3`, `true`, `"OK"`, `{"X": 1234.56, "Y": 789.01}` |
| **observedAt** | DateTime | ✓ | 观测时间戳 | `"2025-08-08T09:36:45.123Z"` |
| **qualityTag** | Property | ✓ | 质量标签 | `OK`, `Warn`, `Error`, `Outlier`, `Interpolated`, `CalFail`, `ClockUnsynced`, `Missing` |
| **provenance** | Property | ✓ | 数据溯源信息 | 详见下表 |
| **relatedData** | Relationship[] | - | 关联数据记录 | `[urn:ngsi-ld:ModalData:...]` |
| **sequenceNumber** | Property | - | 序列号(场景内排序) | 1, 2, 3... |
| **metadata** | Property | - | 扩展元数据 | `{"operator": "张三", "shift": "早班"}` |

#### 溯源信息结构 (provenance.value)

| 子字段 | 类型 | 说明 | 示例 |
|-------|------|------|------|
| **sourceTwinId** | URN | 数据源设备 | `urn:ngsi-ld:TwinObject:AutoEquipment:361-01173` |
| **method** | String | 采集方法 | `"OPC-UA"`, `"Modbus"`, `"Manual"`, `"Calculated"` |
| **swVersion** | String | 软件/固件版本 | `"1.4.0"` |
| **pipelineStage** | String | 数据处理阶段 | `"raw"`, `"filtered"`, `"aggregated"`, `"normalized"` |
| **calculatedBy** | String | 计算程序(衍生数据) | `"MinAggregator-v1.2"` |

#### 数据命名规范

建议格式: `urn:ngsi-ld:ModalData:{ModalityName}.{SceneName}.{Sequence}`

示例:
- `urn:ngsi-ld:ModalData:WeldingCurrent.FrontWelding_20250808.0001`
- `urn:ngsi-ld:ModalData:DriveTemp.Milling_20250808_001.X_Main.0123`

---

## 7. Assignment 岗位指派实体

Assignment实体用于实现人员与岗位角色之间的时态化绑定关系,支撑数字孪生责任流的动态履职管理。

**实体类型**: `Assignment`  
**典型URN**: `urn:ngsi-ld:Assignment:Person.ZhangSan:Welder:SideWallShop:20250908-EarlyShift`

### 核心字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|-----|------|------|
| **id** | URN | ✓ | 指派唯一标识 | `urn:ngsi-ld:Assignment:Person.ZhangSan:Welder:SideWallShop:20250908-EarlyShift` |
| **type** | String | ✓ | 固定为"Assignment" | `Assignment` |
| **assigneeId** | Relationship | ✓ | 被指派人员 | `urn:ngsi-ld:TwinObject:Person:ZhangSan` |
| **roleId** | Relationship | ✓ | 指派的角色 | `urn:ngsi-ld:Role:Welder` |
| **orgId** | Relationship | ✓ | 所属组织单元 | `urn:ngsi-ld:TwinObject:OrgUnit:SideWallLine` |
| **validFrom** | Property | ✓ | 生效起始时间 | `"2025-09-08T08:00:00Z"` |
| **validTo** | Property | ✓ | 生效结束时间 | `"2025-09-08T16:00:00Z"` 或 `"2030-12-31T23:59:59Z"`(长期) |
| **assignmentStatus** | Property | ✓ | 指派状态 | `Active`, `Suspended`, `Revoked`, `Expired` |
| **shiftId** | Property | - | 班次标识 | `"EarlyShift"`, `"NightShift"`, `"A"`, `"B"` |
| **sceneId** | Relationship | - | 限定场景(临时任务) | `urn:ngsi-ld:Scene:PO123:FrontWelding_001` |
| **qualificationRef** | Relationship[] | - | 人员资质引用 | `[urn:ngsi-ld:Qualification:WelderCert]` |
| **approvalRef** | Relationship | - | 审批记录引用 | `urn:ngsi-ld:Approval:HR-2024-12-20-WS1` |
| **createdBy** | Relationship | - | 创建者 | `urn:ngsi-ld:TwinObject:Person:Scheduler001` |
| **notes** | Property | - | 备注信息 | `"临时支援，替代EMP002病假"` |

### 典型使用场景

1. **日常排班指派**: 张三在早班担任焊工角色
2. **临时任务指派**: 李四临时支援某个生产订单的质检任务
3. **长期职位指派**: 王五长期担任班组长角色
4. **多角色指派**: 赵六同时担任操作工和设备点检员

---

## 8. 实体关系图谱

### 8.1 核心关系概览

```
TwinObject关系网络:
OrgUnit (组织)
  └─ parentOrg → OrgUnit (上级组织)
  └─ childOrgs → OrgUnit[] (下级组织)

Station (工位)
  ├─ stationLocation → OrgUnit (所属组织)
  ├─ hasPositions → Position[] (包含台位)
  └─ deployedEquipments → AutoEquipment[] (部署设备)

Position (台位)
  └─ belongsToStation → Station (所属工位)

AutoEquipment (设备)
  └─ deployedAt → Station (部署位置)

Person (人员)
  ├─ holdsPosition → Position (任职岗位)
  └─ assignedRole → Role[] (分配角色)

Workpiece (工件)
  └─ productType → Product (产品类型)

MBOM关系链:
MBOM_Root
  └─ hasRoute → MBOM_Route
       └─ consistsOfTakts → MBOM_Takt[]
            └─ includesProcesses → MBOM_Process[]
                 ├─ nextProcess → MBOM_Process (后续工序)
                 └─ composedOfSteps → MBOM_Step[]
                      └─ nextStep → MBOM_Step (后续工步)

Scene关系:
Scene
  ├─ workpieceId → Workpiece (关联工件)
  └─ taktRef → MBOM_Takt (关联节拍)

模态数据关系:
ModalityBinding
  ├─ twinId → TwinObject (绑定对象)
  └─ modalityId → Modality (绑定模态)

ModalData (三锚点)
  ├─ refTwin → TwinObject (数据来源)
  ├─ refScene → Scene (数据场景)
  └─ refModality → Modality (数据类型)

Assignment关系:
Assignment
  ├─ assigneeId → Person (被指派人员)
  ├─ roleId → Role (指派角色)
  ├─ orgId → OrgUnit (所属组织)
  └─ sceneId → Scene (限定场景,可选)
```

### 8.2 关键导航路径

**路径1: 从设备到模态数据**
```
AutoEquipment 
  → ModalityBinding (通过twinId反查)
  → Modality (获取数据类型定义)
  → ModalData (通过refTwin + refModality查询实际数据)
```

**路径2: 从工件到执行记录**
```
Workpiece
  → Scene (通过workpieceId反查)
  → stepLog (获取执行日志)
  → ModalData (通过refScene查询运行数据)
```

**路径3: 从工序到资源配置**
```
MBOM_Step
  → stationCode (工位代码)
  → Station (查询工位实体)
  → deployedEquipments (查询配置设备)
  → ModalityBinding (查询设备数据绑定)
```

**路径4: 从人员到职责范围**
```
Person
  → Assignment (通过assigneeId反查)
  → Role (通过roleId获取角色定义)
  → responsibilities (获取职责列表)
```

**路径5: 完整MBOM遍历**
```
Product
  → MBOM_Root (产品MBOM)
  → MBOM_Route (路线)
  → MBOM_Takt[] (节拍序列)
    → MBOM_Process[] (工序序列,通过nextProcess链式)
      → MBOM_Step[] (工步序列,通过nextStep链式)
```

---

## 9. 数据模态清单

当前系统定义了**40种数据模态**,覆盖工艺参数、质量特性、几何参数、环境参数、能源数据和状态事件。

### 9.1 按类别分类

#### 9.1.1 工艺参数类 (ProcessParameter)

| 模态ID | 模态名称 | 单位 | 值类型 | 来源 | 值域范围 |
|-------|---------|------|--------|------|---------|
| WeldingCurrent_Auto | 焊接电流(自动) | A | Number | Sensor | [0, 500] |
| WeldingCurrent_Stat | 焊接电流(统计) | A | Number | Calculated | [0, 500] |
| WeldingVoltage_Auto | 焊接电压(自动) | V | Number | Sensor | [0, 50] |
| WeldingVoltage_Stat | 焊接电压(统计) | V | Number | Calculated | [0, 50] |
| WireSpeed | 送丝速度 | m/min | Number | Sensor | [0, 20] |
| ShieldingGasFlow | 保护气流量 | L/min | Number | Sensor | [5, 25] |
| RobotLinearSpeed | 机器人线速度 | mm/s | Number | Sensor | [0, 1000] |
| RobotTCPPose | TCP位姿 | - | Object | Sensor | - |
| RobotBaseX/Y/Z | 机器人底座坐标 | mm | Number | Sensor | - |
| RobotToolEX/EY/EZ | 工具姿态 | deg | Number | Sensor | [-180, 180] |

#### 9.1.2 质量特性类 (QualityCharacteristic)

| 模态ID | 模态名称 | 单位 | 值类型 | 来源 | 说明 |
|-------|---------|------|--------|------|------|
| DefectDetection | 缺陷检测结果 | - | Boolean/Object | Sensor | 是否检测到缺陷及详情 |
| WeldSeamWidth | 焊缝宽度 | mm | Number | Manual/Sensor | 焊缝宽度测量 |
| WeldSeamHeight | 焊缝高度 | mm | Number | Manual | 焊缝余高测量 |
| DimensionalDeviation | 尺寸偏差 | mm | Number | Sensor | 实测尺寸与目标偏差 |
| SurfaceRoughness | 表面粗糙度 | µm | Number | Manual | Ra值 |

#### 9.1.3 几何参数类 (Geometry)

| 模态ID | 模态名称 | 单位 | 值类型 | 来源 | 说明 |
|-------|---------|------|--------|------|------|
| ProfileOffset | 轮廓偏差 | mm | Array | Sensor | 轮廓曲线偏差数据 |
| PositionAccuracy | 位置精度 | mm | Number | Sensor | 定位精度 |
| AngleDeviation | 角度偏差 | deg | Number | Sensor/Manual | 角度偏差 |

#### 9.1.4 环境参数类 (Environment)

| 模态ID | 模态名称 | 单位 | 值类型 | 来源 | 值域范围 |
|-------|---------|------|--------|------|---------|
| AmbientTemp_Auto | 环境温度(自动) | °C | Number | Sensor | [0, 50] |
| AmbientTemp_Manual | 环境温度(手动) | °C | Number | Manual | [0, 50] |
| Humidity | 湿度 | %RH | Number | Sensor | [0, 100] |
| AtmosphericPressure | 大气压 | kPa | Number | Sensor | [80, 110] |

#### 9.1.5 能源数据类 (Energy)

| 模态ID | 模态名称 | 单位 | 值类型 | 来源 | 说明 |
|-------|---------|------|--------|------|------|
| TotalEnergyConsumption | 总能耗 | kWh | Number | Sensor | 累计能耗 |
| PowerOnDuration | 开机时长 | min | Number | Sensor | 设备开机累计时长 |
| OperationDuration | 运行时长 | min | Number | Sensor | 实际运行时长(扣除待机) |
| InstantPower | 瞬时功率 | kW | Number | Sensor | 当前功率 |

#### 9.1.6 状态与事件类 (State/Event)

| 模态ID | 模态名称 | 值类型 | 来源 | 说明 |
|-------|---------|--------|------|------|
| EquipmentStatus | 设备状态 | Text | Sensor | Running/Idle/Fault/Maintenance |
| AlarmEvent | 报警事件 | Object | Sensor | 报警代码、级别、描述 |
| ProcessStepCompletion | 工步完成事件 | Boolean | System | 工步是否完成 |
| QualityCheckResult | 质量检验结果 | Text | Manual | OK/NG/Rework |

### 9.2 模态与设备绑定统计

| 设备类型 | 典型绑定模态数 | 主要模态类别 |
|---------|--------------|-------------|
| WeldingRobot | 10-15 | 焊接电流/电压、气体流量、TCP位姿、能耗 |
| Positioner | 5-8 | 旋转角度、速度、定位精度、状态 |
| QCTool (检具) | 3-5 | 尺寸偏差、轮廓偏差、检测结果 |
| Station | 2-4 | 环境温度、湿度、状态 |

---

## 10. 业务场景数据映射

针对四个业务优化方向,列出所需的核心实体和字段。

### 10.1 生产计划可行性验证

**目标**: 验证给定生产计划是否可行,识别资源冲突和瓶颈

**所需实体与字段**:

| 实体类型 | 核心字段 | 用途 |
|---------|---------|------|
| **Product** | productCode, productName | 识别待生产产品 |
| **MBOM_Root** | productCode, totalEstimatedTime | 获取工艺路线和总工时 |
| **MBOM_Takt** | targetCT, estimatedDuration | 节拍时间预估 |
| **MBOM_Process** | procName, estimatedDuration | 工序时间预估 |
| **MBOM_Step** | stepName, stdTime, stationCode | 工步标准工时和工位需求 |
| **Station** | stationCategory, capacityWip | 工位产能和在制品容量 |
| **AutoEquipment** | equipmentType, deployedAt | 设备类型和部署位置 |
| **Person** | skills, shiftSchedule | 人员技能和排班 |
| **Assignment** | assigneeId, roleId, validFrom, validTo | 人员指派时间段 |
| **Scene** (历史) | sceneStartTime, sceneEndTime, stepLog | 历史实际执行时间 |

**典型查询逻辑**:
1. 根据产品获取MBOM完整路线
2. 计算每个工步所需资源(工位、设备、人员技能)
3. 检查工位产能、设备可用性、人员技能匹配
4. 识别资源冲突和瓶颈
5. 基于历史Scene数据修正标准工时

---

### 10.2 生产价值流分析

**目标**: 分析生产过程中的增值与非增值活动,优化流程

**所需实体与字段**:

| 实体类型 | 核心字段 | 用途 |
|---------|---------|------|
| **Workpiece** | workpieceCode, productType, startTime | 工件追踪 |
| **Scene** | workpieceId, taktRef, sceneStartTime, sceneEndTime, stepLog | 完整执行过程 |
| **MBOM_Step** | stepName, stdTime, processKind | 标准工时和工步类型 |
| **ModalData** | refScene, refModality, value, observedAt | 过程数据(电流、速度等) |
| **Station** | stationCategory, location | 工位位置和类型 |
| **stepLog.actualDuration** | - | 实际执行时间 |
| **stepLog.operators** | - | 操作人员 |

**价值流指标计算**:
- **增值时间**: processKind = "process" 的工步实际用时
- **非增值时间**: processKind = "handling" 的搬运时间
- **等待时间**: sceneStartTime 与上一Scene的 sceneEndTime 之差
- **节拍时间**: Scene的总用时
- **流程效率**: 增值时间 / 总时间

---

### 10.3 在制品库存控制

**目标**: 监控在制品数量和分布,优化库存水平

**所需实体与字段**:

| 实体类型 | 核心字段 | 用途 |
|---------|---------|------|
| **Workpiece** | workpieceCode, currentStatus, currentLocation | 工件当前状态和位置 |
| **Scene** | workpieceId, sceneStatus, sceneStartTime | 场景执行状态 |
| **Station** | stationCategory, capacityWip | 工位在制品容量 |
| **MBOM_Takt** | taktSeq, targetCT | 节拍顺序和目标时间 |
| **Product** | productCode | 产品分类 |

**库存分析逻辑**:
1. 统计各工位的当前在制品数量: `COUNT(Workpiece WHERE currentLocation = Station.id)`
2. 识别超容工位: `Workpiece数量 > Station.capacityWip`
3. 计算工件在各工位的停留时间
4. 按节拍统计在制品分布
5. 预测瓶颈工位

---

### 10.4 侧墙生产质量改进

**目标**: 分析质量问题根因,改进工艺参数和操作规范

**所需实体与字段**:

| 实体类型 | 核心字段 | 用途 |
|---------|---------|------|
| **Workpiece** | workpieceCode, productType | 工件标识 |
| **Scene** | workpieceId, taktRef, stepLog | 生产过程 |
| **MBOM_Step** | stepName, requiredMeasurements | 工步和测量要求 |
| **Modality** | name, category, allowedRange | 质量参数定义和规范 |
| **ModalData** | refScene, refModality, value, qualityTag, observedAt | 实际质量数据 |
| **stepLog.qualityStatus** | - | 工步质量状态(OK/NG/Rework) |
| **stepLog.operators** | - | 操作人员 |
| **AutoEquipment** | equipmentType, model, serialNumber | 使用设备 |

**质量分析维度**:
1. **缺陷统计**: 按工步、设备、人员统计NG率
2. **参数偏差分析**: ModalData.value 与 Modality.allowedRange 对比
3. **工艺稳定性**: 分析关键参数(焊接电流、电压)的波动范围
4. **设备影响**: 对比不同设备的质量数据差异
5. **人员影响**: 对比不同操作人员的质量结果
6. **根因追溯**: 从NG工件反查Scene → ModalData → 参数异常

---

## 附录A: 字段类型说明

| NGSI-LD类型 | 说明 | JSON结构示例 |
|------------|------|------------|
| **Property** | 属性值 | `{"type": "Property", "value": "值"}` |
| **Relationship** | 关系引用 | `{"type": "Relationship", "object": "urn:..."}` |
| **GeoProperty** | 地理位置 | `{"type": "GeoProperty", "value": {"type": "Point", "coordinates": [x,y,z]}}` |

---

## 附录B: 枚举值速查

### B.1 组织类型 (orgUnitType)
- `Factory` - 工厂
- `Workshop` - 车间
- `ProductionLine` - 生产线
- `Team` - 班组
- `Department` - 部门
- `Division` - 事业部

### B.2 工位类别 (stationCategory)
- `ProductionStation` - 生产工位
- `InspectionStation` - 检验工位
- `AssemblyStation` - 装配工位
- `BufferZone` - 缓冲区
- `HandlingStation` - 搬运工位

### B.3 设备类型 (equipmentType)
- `WeldingRobot` - 焊接机器人
- `Welder` - 焊机
- `Positioner` - 变位机
- `CNC` - 数控机床
- `PressMachine` - 压力机
- `Laser` - 激光设备

### B.4 工序类型 (processKind)
- `process` - 加工
- `handling` - 搬运
- `inspection` - 检验
- `andon` - 报警
- `measurement` - 测量

### B.5 质量标签 (qualityTag)
- `OK` - 正常
- `Warn` - 警告
- `Error` - 错误
- `Outlier` - 异常值
- `Interpolated` - 插值
- `CalFail` - 计算失败
- `ClockUnsynced` - 时钟未同步
- `Missing` - 缺失

---

## 文档更新记录

| 版本 | 日期 | 更新内容 | 更新人 |
|-----|------|---------|-------|
| v1.0 | 2025-11-10 | 初始版本,完整数据目录 | 数字孪生团队 |

---

**文档结束**
